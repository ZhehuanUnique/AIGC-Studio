# 检查数据库连接步骤

## 问题：显示"本地模式"而不是"云端数据库"

这说明 API 调用失败了，应用回退到了 localStorage。

## 解决步骤：

### 1. 确认数据库已连接到 Vercel 项目

从你提供的图片看，数据库 "AIGC-Studio_Database" 已经创建了，但需要确保它已连接到你的 Vercel 项目：

1. 在 Vercel Dashboard → 你的项目 → Settings → Storage
2. 确认 "AIGC-Studio_Database" 出现在列表中
3. 如果没有，点击 "Connect Database" 按钮连接数据库

### 2. 配置环境变量（最重要！）

即使数据库已连接，也需要手动添加环境变量：

1. 在 Vercel Dashboard → 你的项目 → Settings → Environment Variables
2. 点击 "Add New"
3. 添加以下变量：

**变量名：** `DATABASE_URL`  
**值：** 从 Neon 数据库页面复制 `.env.local` 标签页中的 `DATABASE_URL` 值  
**环境：** 选择 "Production" 和 "Preview"（建议两个都选）

**变量名：** `BLOB_READ_WRITE_TOKEN`  
**值：** 从 Vercel Dashboard → Storage → 创建 Blob Store（如果没有）→ 复制 Token  
**环境：** 选择 "Production" 和 "Preview"

### 3. 获取 DATABASE_URL

从你提供的图片：
1. 在 Neon 数据库页面，点击 ".env.local" 标签
2. 点击 "Show secret" 眼睛图标显示完整连接字符串
3. 复制 `DATABASE_URL=` 后面的完整字符串（不要包含引号）
4. 粘贴到 Vercel 环境变量中

### 4. 重新部署项目

**重要：** 添加或修改环境变量后，必须重新部署才能生效！

1. 在 Vercel Dashboard → 你的项目 → Deployments
2. 点击最新的部署右侧的 "..." 菜单
3. 选择 "Redeploy"
4. 或者直接推送代码触发自动部署

### 5. 验证连接

部署完成后：

1. 打开你的网站（比如 https://jubianstudio.cn）
2. 按 F12 打开开发者工具
3. 查看 Console 标签页：
   - 如果看到 "✅ 数据已从云端数据库加载" → 成功！
   - 如果看到 "⚠️ API 加载失败" → 查看具体错误信息

4. 或者直接测试 API：
   在浏览器地址栏输入：
   ```
   https://你的域名/api/teams
   ```
   应该返回 JSON 格式的团队数据

### 6. 如果还是失败

检查以下几点：

1. **数据库表是否存在**
   - 在 Neon 数据库页面点击 "Open in Neon"
   - 执行 `lib/init-db.sql` 中的 SQL 脚本创建表

2. **API 端点是否可访问**
   - 直接访问 `https://你的域名/api/teams`
   - 如果返回 500 错误，查看 Vercel Functions 日志

3. **环境变量是否正确**
   - 确认 `DATABASE_URL` 格式正确（通常以 `postgresql://` 开头）
   - 确认环境变量添加到了正确的环境（Production/Preview）

4. **检查 Vercel Functions 日志**
   - Vercel Dashboard → 项目 → Deployments → 点击最新部署 → Functions 标签
   - 查看是否有错误日志

## 快速检查清单

- [ ] 数据库已连接到 Vercel 项目
- [ ] `DATABASE_URL` 环境变量已配置
- [ ] `BLOB_READ_WRITE_TOKEN` 环境变量已配置（用于图片上传）
- [ ] 环境变量已添加到 Production 环境
- [ ] 项目已重新部署（添加环境变量后）
- [ ] 数据库表已创建（执行了 init-db.sql）
- [ ] API 端点可访问（/api/teams 返回数据）

